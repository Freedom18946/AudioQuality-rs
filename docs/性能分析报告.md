# AudioQuality-rs 性能说明（当前实现）

## 主要耗时阶段

1. 指纹计算（SHA-256）
2. ffmpeg/ffprobe 指标提取
3. 报告序列化输出

其中第 2 步通常占大头。

## 性能控制项

- `--max-ffmpeg-processes`：控制外部进程总并发
- `--ffmpeg-timeout-seconds`：避免异常媒体导致长时间阻塞
- 增量缓存（默认开启）：命中后可显著减少重复分析时间

## 缓存效果

缓存命中条件：`mtime + size + sha256` 一致。

命中后：

- 直接复用历史 `FileMetrics`
- `processingTimeMs` 置为 `0`
- `cacheHit` 置为 `true`

## 建议

- 首次全量扫描：适当提高并发（视 CPU/IO 而定）
- 常规重复扫描：保持缓存开启
- 磁盘/CPU压力高场景：降低并发并适当增大 timeout
